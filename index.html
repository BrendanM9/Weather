<!DOCTYPE html>
<html>
    <head>
        <title>Central Oregon Forecast</title>
        <meta charset="UTF-8">
        <link rel="stylesheet" href="weatherstyle.css">
        <!--<div id="favicon"></div>-->
        <link rel="icon" type="image/x-icon" href="icons/4.png">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    </head>
    <body>
        <h1>Live local forecast:</h1>
        <div class="column" id="b1">
            Current Conditions:
        <div id="currentc">
            <div id="icon">
                <img src="icons/44.png" class="icon">
            </div> 
            <p id="condition"></p>
            <p id="temp">Temperature: --ºF</p>
            <p id="humidity">Humidity: --%</p>
            <p id="winddir">Wind Direction: --º</p>
            <p id="windspeed">Wind Speed: -- MPH</p>
            <p id="windgusts">Wind Gust: -- MPH</p>
            <p id="precip">Precipitation: -- in</p>
            <p id="pressure">Absolute Pressure: -- inHG</p>
            <p id="uv">UV Index: --</p>
            <p id="feellike">Feels Like: --</p>
            <br><br><br>
        </div>
        </div>
        <p id="abspress" hidden></p>
        <div class="column" id="b2">
        <div id="text1"></div>
        <div id="icon1">
            <img src="icons/44.png" class="icon">
        </div>
        <div id="icon2a">
            <img src="icons/44.png" class="icon">
        </div>
        <p id="hi1" class="hi">High: --º</p>
        <p id="lo1" class="lo">Low: --º</p>
        <p id="p1">Precipitation Chance: -- %</p>
        <p id="qpf1">Amount of Precipitation: -.-- in</p>
        <p id="condition1">--</p><br><br><br>
        </div>
        <div class="column" id="b3">
            <div id="text3"></div>
            <div id="icon3">
                <img src="icons/44.png" class="icon">
            </div>
            <div id="icon4">
                <img src="icons/44.png" class="icon">
            </div>
            <p id="hi3" class="hi">High: --º</p>
            <p id="lo3" class="lo">Low: --º</p>
            <p id="p3">Precipitation Chance: -- %</p>
            <p id="qpf3">Amount of Precipitation: -.-- in</p>
            <p id="condition3">--</p>
        </div>
        <div class="column" id="b4">
            <div id="text5"></div>
            <div id="icon5">
                <img src="icons/44.png" class="icon">
            </div>
            <div id="icon6">
                <img src="icons/44.png" class="icon">
            </div>
            <p id="hi5" class="hi">High: --º</p>
            <p id="lo5" class="lo">Low: --º</p>
            <p id="p5">Precipitation Chance: -- %</p>
            <p id="qpf5">Amount of Precipitation: -.-- in</p>
            <p id="condition5">--</p>
        </div>
        <div class="column" id="b5">
            <div id="text7"></div>
            <div id="icon7">
                <img src="icons/44.png" class="icon">
            </div>
            <div id="icon8">
                <img src="icons/44.png" class="icon">
            </div>
            <p id="hi7" class="hi">High: --º</p>
            <p id="lo7" class="lo">Low: --º</p>
            <p id="p7">Precipitation Chance: -- %</p>
            <p id="qpf7">Amount of Precipitation: -.-- in</p>
            <p id="condition7">--</p>
        </div>
        <div class="column" id="b6">
            <div id="text9"></div>
            <div id="icon9">
                <img src="icons/44.png" class="icon">
            </div>
            <div id="icon10">
                <img src="icons/44.png" class="icon">
            </div>
            <p id="hi9" class="hi">High: --º</p>
            <p id="lo9" class="lo">Low: --º</p>
            <p id="p9">Precipitation Chance: -- %</p>
            <p id="qpf9">Amount of Precipitation: -.-- in</p>
            <p id="condition9">--</p>
        </div>
        <div class="column" id="b7">
            <div id="text11"></div>
            <div id="icon11">
                <img src="icons/44.png" class="icon">
            </div>
            <div id="icon12">
                <img src="icons/44.png" class="icon">
            </div>
            <p id="hi11" class="hi">High: --º</p>
            <p id="lo11" class="lo">Low: --º</p>
            <p id="p11">Precipitation Chance: -- %</p>
            <p id="qpf11">Amount of Precipitation: -.-- in</p>
            <p id="condition11">--</p>
        </div>
        <script>
            var abspressEl = document.getElementById("abspress");
            const inHGav = 29.97;
            const bendID = "KORBEND727"; const ICAO = "KRDM";
            const apiKey = "be3a60645b954897ba60645b95f89776";
            var hi1El = document.getElementById("hi1");
            var lo1El = document.getElementById("lo1");
            var today = document.getElementById("condition");
            var future = document.getElementById("condition1");
            var tomorrow = document.getElementById("condition2");
            var day2 = document.getElementById("condition3");
            var day3 = document.getElementById("condition4");
            var day4 = document.getElementById("condition5");
            var iconEl = document.getElementById("icon");
            var icon1El =document.getElementById("icon1");
            var icon2El = document.getElementById("icon2a");
            var icon3El = document.getElementById("icon3");
            var icon4El = document.getElementById("icon4");
            var icon5El = document.getElementById("icon5");
            var condition = 44;
            var season = "string";
            var date = new Date();
            month = date.getMonth() + 1;
            day = date.getDate();
            console.log(month, day);
            if(month === 9 && day >= 23 || month === 12 && day < 21 || month > 9 && month < 12){
                season = "Autumn"
            } else if(month === 6 && day >= 20 || month === 9 && day < 23 || month > 6 && month < 9){
                season = "Summer";
            } else if(month === 3 && day >= 19 || month === 6 && day < 20 || month > 3 && month < 6){
                season = "Spring";
            } else if(month === 12 && day >= 21 || month === 3 && day < 19 || month > 0 && month < 3){
                season = "Winter";
            }
            if(season === "Autumn"){
                document.body.style.backgroundColor = "orange";
            } else if(season==="Summer"){
                document.body.style.backgroundImage = "url('backgrounds/sunny.png')"
            } else if(season==="Winter"){
                document.body.style.backgroundImage = "url('backgrounds/IMG_0200.jpeg')"
            } else if(season === "Spring"){
                document.body.style.backgroundColor= "green";
            }
            forecast = function( f ){
                console.log(f);
                document.getElementById("hi1").innerHTML = "High: "+f.calendarDayTemperatureMax[0]+"º";
                document.getElementById("hi3").innerHTML = "High: "+f.temperatureMax[1]+"º";
                document.getElementById("hi5").innerHTML = "High: "+f.temperatureMax[2]+"º";
                document.getElementById("hi7").innerHTML = "High: "+f.temperatureMax[3]+"º";
                document.getElementById("hi9").innerHTML = "High: "+f.temperatureMax[4]+"º";
                document.getElementById("hi11").innerHTML = "High: "+f.temperatureMax[5]+"º";
                document.getElementById("lo1").innerHTML = "Low: "+f.temperatureMin[0]+"º";
                document.getElementById("lo3").innerHTML = "Low: "+f.temperatureMin[1]+"º";
                document.getElementById("lo5").innerHTML = "Low: "+f.temperatureMin[2]+"º";
                document.getElementById("lo7").innerHTML = "Low: "+f.temperatureMin[3]+"º";
                document.getElementById("lo9").innerHTML = "Low: "+f.temperatureMin[4]+"º";
                document.getElementById("lo11").innerHTML = "Low: "+f.temperatureMin[5]+"º";
                document.getElementById("condition1").innerHTML = f.narrative[0];
                document.getElementById("condition3").innerHTML = f.narrative[1];
                document.getElementById("condition5").innerHTML = f.narrative[2];
                document.getElementById("condition7").innerHTML = f.narrative[3];
                document.getElementById("condition9").innerHTML = f.narrative[4];
                document.getElementById("condition11").innerHTML = f.narrative[5];
                document.getElementById("text1").innerHTML = f.dayOfWeek[0];
                document.getElementById("text3").innerHTML = f.dayOfWeek[1];
                document.getElementById("text5").innerHTML = f.dayOfWeek[2];
                document.getElementById("text7").innerHTML = f.dayOfWeek[3];
                document.getElementById("text9").innerHTML = f.dayOfWeek[4];
                document.getElementById("text11").innerHTML = f.dayOfWeek[5];
                if(f.daypart[0].iconCode[0] === null){
                    document.getElementById("icon1").innerHTML = "<img src='icons/30.png' class='icon'>";
                } else {
                document.getElementById("icon1").innerHTML = "<img src='icons/"+f.daypart[0].iconCode[0]+".png' class='icon'>";
                }
                document.getElementById("icon2a").innerHTML = "<img src='icons/"+f.daypart[0].iconCode[1]+".png' class='icon'>";
                document.getElementById("icon3").innerHTML = "<img src='icons/"+f.daypart[0].iconCode[2]+".png' class='icon'>";
                document.getElementById("icon4").innerHTML = "<img src='icons/"+f.daypart[0].iconCode[3]+".png' class='icon'>";
                document.getElementById("icon5").innerHTML = "<img src='icons/"+f.daypart[0].iconCode[4]+".png' class='icon'>";
                document.getElementById("icon6").innerHTML = "<img src='icons/"+f.daypart[0].iconCode[5]+".png' class='icon'>";
                document.getElementById("icon7").innerHTML = "<img src='icons/"+f.daypart[0].iconCode[6]+".png' class='icon'>";
                document.getElementById("icon8").innerHTML = "<img src='icons/"+f.daypart[0].iconCode[7]+".png' class='icon'>";
                document.getElementById("icon9").innerHTML = "<img src='icons/"+f.daypart[0].iconCode[8]+".png' class='icon'>";
                document.getElementById("icon10").innerHTML = "<img src='icons/"+f.daypart[0].iconCode[9]+".png' class='icon'>";
                document.getElementById("icon11").innerHTML = "<img src='icons/"+f.daypart[0].iconCode[10]+".png' class='icon'>";
                document.getElementById("icon12").innerHTML = "<img src='icons/"+f.daypart[0].iconCode[11]+".png' class='icon'>";
                document.getElementById("p1").innerHTML = "Preciptiation Chance: "+ f.daypart[0].precipChance[1]+"%";
                document.getElementById("p3").innerHTML = "Preciptiation Chance: "+ f.daypart[0].precipChance[3]+"%";
                document.getElementById("p5").innerHTML = "Preciptiation Chance: "+ f.daypart[0].precipChance[5]+"%";
                document.getElementById("p7").innerHTML = "Preciptiation Chance: "+ f.daypart[0].precipChance[7]+"%";
                document.getElementById("p9").innerHTML = "Preciptiation Chance: "+ f.daypart[0].precipChance[9]+"%";
                document.getElementById("p11").innerHTML = "Preciptiation Chance: "+ f.daypart[0].precipChance[11]+"%";
                if(f.daypart[0].wxPhraseShort[1]==="P Cloudy" || f.daypart[0].wxPhraseShort[1]==="M Sunny" || f.daypart[0].wxPhraseShort[1]==="M Clear" || f.daypart[0].wxPhraseShort[1]==="M Cloudy"){
                    document.getElementById("b2").style.backgroundImage = "url('backgrounds/partly_cloudy.png')";
                } else if (f.daypart[0].wxPhraseShort[1]==="Sunny"|| f.daypart[0].wxPhraseShort[1]==="Clear"){
                    document.getElementById("b2").style.backgroundImage = "url('backgrounds/sunny.png')";
                } else if (f.daypart[0].wxPhraseShort[1]==="Cloudy"){
                    document.getElementById("b2").style.backgroundImage = "url('backgrounds/cloudy.png')";
                }
                if(f.daypart[0].wxPhraseShort[2]==="P Cloudy" || f.daypart[0].wxPhraseShort[2]==="M Sunny" || f.daypart[0].wxPhraseShort[2]==="M Clear" || f.daypart[0].wxPhraseShort[2]==="M Cloudy"){
                    document.getElementById("b3").style.backgroundImage = "url('backgrounds/partly_cloudy.png')";
                } else if (f.daypart[0].wxPhraseShort[2]==="Sunny"|| f.daypart[0].wxPhraseShort[2]==="Clear"){
                    document.getElementById("b3").style.backgroundImage = "url('backgrounds/sunny.png')";
                } else if (f.daypart[0].wxPhraseShort[2]==="Cloudy"){
                    document.getElementById("b3").style.backgroundImage = "url('backgrounds/cloudy.png')";
                }
                if(f.daypart[0].wxPhraseShort[4]==="P Cloudy" || f.daypart[0].wxPhraseShort[4]==="M Sunny" || f.daypart[0].wxPhraseShort[4]==="M Clear" || f.daypart[0].wxPhraseShort[4]==="M Cloudy"){
                    document.getElementById("b4").style.backgroundImage = "url('backgrounds/partly_cloudy.png')";
                } else if (f.daypart[0].wxPhraseShort[4]==="Sunny"|| f.daypart[0].wxPhraseShort[4]==="Clear"){
                    document.getElementById("b4").style.backgroundImage = "url('backgrounds/sunny.png')";
                } else if (f.daypart[0].wxPhraseShort[4]==="Cloudy"){
                    document.getElementById("b4").style.backgroundImage = "url('backgrounds/cloudy.png')";
                }
                if(f.daypart[0].wxPhraseShort[6]==="P Cloudy" || f.daypart[0].wxPhraseShort[6]==="M Sunny" || f.daypart[0].wxPhraseShort[6]==="M Clear" || f.daypart[0].wxPhraseShort[6]==="M Cloudy"){
                    document.getElementById("b5").style.backgroundImage = "url('backgrounds/partly_cloudy.png')";
                } else if (f.daypart[0].wxPhraseShort[6]==="Sunny"|| f.daypart[0].wxPhraseShort[6]==="Clear"){
                    document.getElementById("b5").style.backgroundImage = "url('backgrounds/sunny.png')";
                } else if (f.daypart[0].wxPhraseShort[6]==="Cloudy"){
                    document.getElementById("b5").style.backgroundImage = "url('backgrounds/cloudy.png')";
                }
                console.log(season)
                if(f.daypart[0].wxPhraseShort[8]==="P Cloudy" || f.daypart[0].wxPhraseShort[8]==="M Sunny" || f.daypart[0].wxPhraseShort[8]==="M Clear" || f.daypart[0].wxPhraseShort[8]==="M Cloudy"){
                    document.getElementById("b6").style.backgroundImage = "url('backgrounds/partly_cloudy.png')";
                } else if (f.daypart[0].wxPhraseShort[8]==="Sunny"|| f.daypart[0].wxPhraseShort[8]==="Clear"){
                    document.getElementById("b6").style.backgroundImage = "url('backgrounds/sunny.png')";
                } else if (f.daypart[0].wxPhraseShort[8]==="Cloudy"){
                    document.getElementById("b6").style.backgroundImage = "url('backgrounds/cloudy.png')";
                }
                if(f.daypart[0].wxPhraseShort[10]==="P Cloudy" || f.daypart[0].wxPhraseShort[10]==="M Sunny" || f.daypart[0].wxPhraseShort[10]==="M Clear" || f.daypart[0].wxPhraseShort[10]==="M Cloudy"){
                    document.getElementById("b7").style.backgroundImage = "url('backgrounds/partly_cloudy.png')";
                } else if (f.daypart[0].wxPhraseShort[10]==="Sunny"|| f.daypart[0].wxPhraseShort[10]==="Clear"){
                    document.getElementById("b7").style.backgroundImage = "url('backgrounds/sunny.png')";
                } else if (f.daypart[0].wxPhraseShort[10]==="Cloudy"){
                    document.getElementById("b7").style.backgroundImage = "url('backgrounds/cloudy.png')";
                }
                if (parseFloat(f.qpf[0])>= parseFloat(f.qpfSnow[0])){
                    document.getElementById("qpf1").innerHTML = "Rain Amount: "+ f.qpf[0]+"in";
                } else {
                    document.getElementById("qpf1").innerHTML = "Snow Amount: "+ f.qpfSnow[0]+"in";
                }
                if (parseFloat(f.qpf[1])>= parseFloat(f.qpfSnow[1])){
                    document.getElementById("qpf3").innerHTML = "Rain Amount: "+ f.qpf[1]+"in";
                } else {
                    document.getElementById("qpf3").innerHTML = "Snow Amount: "+ f.qpfSnow[1]+"in";
                }
                if (parseFloat(f.qpf[2])>= parseFloat(f.qpfSnow[2])){
                    document.getElementById("qpf5").innerHTML = "Rain Amount: "+ f.qpf[2]+"in";
                } else {
                    document.getElementById("qpf5").innerHTML = "Snow Amount: "+ f.qpfSnow[2]+"in";
                }if (parseFloat(f.qpf[3])>= parseFloat(f.qpfSnow[3])){
                    document.getElementById("qpf7").innerHTML = "Rain Amount: "+ f.qpf[3]+"in";
                } else {
                    document.getElementById("qpf7").innerHTML = "Snow Amount: "+ f.qpfSnow[3]+"in";
                }
                if (parseFloat(f.qpf[4])>= parseFloat(f.qpfSnow[4])){
                    document.getElementById("qpf9").innerHTML = "Rain Amount: "+ f.qpf[4]+"in";
                } else {
                    document.getElementById("qpf9").innerHTML = "Snow Amount: "+ f.qpfSnow[4]+"in";
                }
                if (parseFloat(f.qpf[5])>= parseFloat(f.qpfSnow[5])){
                    document.getElementById("qpf11").innerHTML = "Rain Amount: "+ f.qpf[5]+"in";
                } else {
                    document.getElementById("qpf11").innerHTML = "Snow Amount: "+ f.qpfSnow[5]+"in";
                }
            }
            var currentpressure;
            var hindex;
            var wchill;
            var temp1;
            var realFeel;
            var light;
            var rain;
            var time;
            var amtemp;
            function drawWeather (d){
                console.log("Weather data \n", d);
                hindex = d.observations[0].imperial.heatIndex;
                chill = d.observations[0].imperial.windChill; 
                temp1 = d.observations[0].imperial.temp;
                light = d.observations[0].solarRadiation;
                rain = d.observations[0].imperial.precipRate;
                time = d.observations[0].obsTimeLocal;
                amtemp = d.observations[0].imperial.temp;
                wind = d.observations[0].imperial.windSpeed;
                document.getElementById("condition").innerHTML = d.observations[0]
                document.getElementById("temp").innerHTML = "Temperature: "+ temp1+"ºF";
                document.getElementById("humidity").innerHTML = "Humidity: "+ d.observations[0].humidity +"%";
                document.getElementById("winddir").innerHTML = "Wind Direction: "+d.observations[0].winddir+"º";
                document.getElementById("windspeed").innerHTML = "Wind Speed: "+d.observations[0].imperial.windSpeed+" MPH";
                document.getElementById("windgusts").innerHTML = "Wind Gust: "+d.observations[0].imperial.windGust+" MPH";
                document.getElementById("precip").innerHTML = "Precipitation: "+d.observations[0].imperial.precipTotal+" in";
                if(parseFloat(d.observations[0].imperial.pressure)===29.8){
                    document.getElementById("pressure").innerHTML = "Pressure: 29.80inHG"
                } else {
                    document.getElementById("pressure").innerHTML = "Pressure: "+d.observations[0].imperial.pressure+"inHG";
                }
                document.getElementById("uv").innerHTML = "UV Index: "+d.observations[0].uv;
                document.getElementById("feellike").innerHTML = "Feels Like: "+d.observations[0].imperial.heatIndex+"º";
                currentConditions(light, rain, time, amtemp, wind);
                currentpressure = d.observations[0].imperial.pressure;
                abspressEl.innerHTML = currentpressure;
                //forecast(currentpressure);
                //feelslike(hindex, wchill);
            }
            function weatherBalloon(cityID){
                var key=apiKey;
                fetch('https://api.weather.com/v2/pws/observations/current?stationId='+cityID+'&format=json&units=e&apiKey='+key)
                .then(function(resp) {return resp.json() })
                .then(function(data) {
                    drawWeather(data);
                })
                .catch(function(){

                });  
                fetch('https://api.weather.com/v3/wx/forecast/daily/5day?icaoCode='+ICAO+'&units=e&language=en-US&format=json&apiKey='+key)
                .then(function(resp) {return resp.json()})
                .then (function(data) {
                    forecast(data);
                })
                .catch(function(){

                });
            }
            window.onload = function(){
                weatherBalloon(bendID);
                //forecast(currentpressure);
            }
            var currentConditions = function(l, r, t, a, w){
                var l1 = parseInt(l);
                var r1 = parseFloat(r);
                var a1 = parseInt(a);
                var w1 = parseInt(w);
                var currentDate = new Date();
                var time = currentDate.getHours();
                console.log("Time: \n", time);
                console.log(r1);
                if(r1 === 1 && a1 > 32){
                    iconEl.innerHTML = "<img src='icons/9.png' class='icon'>";
                    today.innerHTML = "<p>Drizzle</p>";
                    condition = 9;
                }else if(r1 > 1 && a1 > 32){
                    iconEl.innerHTML = "<img src='icons/12.png' class='icon'>";
                    today.innerHTML = "<p>Rain Showers</p>"
                    condition = 12;
                }else if(r1 > 0 && a1 === 32){
                    iconEl.innerHTML = "<img src='icons/7.png' class='icon'>";
                    today.innerHTML = "<p>Wintery Mix</p>";
                    condition = 7;
                }else if(r1 === 1 && a1 < 32){
                    iconEl.innerHTML = "<img src='icons/13.png' class='icon'>";
                    today.innerHTML = "<p>Flurries</p>";
                    condition = 13;
                }else if(r1 > 1 && a1 < 32){
                    iconEl.innerHTML = "<img src='icons/14.png' class='icon'>";
                    today.innerHTML = "<p>Snow Showers</p>";
                    condition = 14;
                }else if(l1 >= 0 && l1 <= 200 && r1 < 0.01){
                    if(time >= 7 && time < 19){
                        iconEl.innerHTML = "<img src='icons/26.png' class='icon'>";
                        //favEl.innerHTML = '<link rel="icon" type="image/x-icon" href="icons/26.png">'; 
                        today.innerHTML = "<p>Cloudy</p>";
                        document.getElementById("b1").style.backgroundImage= "url('backgrounds/cloudy.png')"
                        condition = 26;
                    } else if(time < 7 || time >= 19){
                        iconEl.innerHTML = "<img src='icons/27.png' class='icon'>";
                        //favEl.innerHTML = '<link rel="icon" type="image/x-icon" href="icons/27.png">';
                        today.innerHTML = "<p>Partly Cloudy</p>";
                        document.getElementById("b1").style.backgroundImage= "url('backgrounds/partly_cloudy.png')"
                        condition = 27;
                    }
                }else if(l1 > 200 && l1<= 400 && r1 < 0.01){
                    if(time >= 7 && time < 19){
                        iconEl.innerHTML = "<img src='icons/28.png' class='icon'>";
                        condition = 28;
                    } else if(time < 7 || time >= 19){
                        iconEl.innerHTML = "<img src='icons/27.png' class='icon'>";
                        condition = 27;
                    }
                    today.innerHTML = "<p>Partly Cloudy</p>";
                    document.getElementById("b1").style.backgroundImage= "url('backgrounds/partly_cloudy.png')"
                }else if(l1 > 400){
                    if(time >= 7 && time < 19){
                        iconEl.innerHTML = "<img src='icons/32.png' class='icon'>";
                        condition = 32;
                    } else if(time < 7 || time >= 19){
                        iconEl.innerHTML = "<img src='icons/31.png' class='icon'>";
                        condition = 31;
                    }
                    today.innerHTML = "<p>Clear</p>";
                    document.getElementById("b1").style.backgroundImage= "url('backgrounds/sunny.png')"
                }
            }
            if(rain>0){
            let hrElement;
            let counter = 100;
            for (let i = 0; i < counter; i++) {
                hrElement = document.createElement("HR");
                hrElement.style.left = Math.floor(Math.random() * window.innerWidth) + "px";
                hrElement.style.animationDuration = 0.2 + Math.random() * 0.3 + "s";
                hrElement.style.animationDelay = Math.random() * 5 + "s";
                document.body.appendChild(hrElement);
            }
            }
        </script>
    </body>
</html>