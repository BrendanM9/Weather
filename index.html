<!DOCTYPE html>
<html>
    <head>
        <title>Central Oregon Forecast</title>
        <meta charset="UTF-8">
        <link rel="stylesheet" href="weatherstyle.css">
        <!--<div id="favicon"></div>-->
        <link rel="icon" type="image/x-icon" href="icons/4.png">
    </head>
    <body>
        <h1>Live local forecast:</h1>
        <div class="column">
            Current Conditions:
        <div id="currentc">
            <div id="icon">
                <img src="icons/44.png" class="icon">
            </div> 
            <p id="condition"></p>
            <p id="temp">Temperature: --ºF</p>
            <p id="humidity">Humidity: --%</p>
            <p id="winddir">Wind Direction: --º</p>
            <p id="windspeed">Wind Speed: -- MPH</p>
            <p id="windgusts">Wind Gust: -- MPH</p>
            <p id="precip">Precipitation: -- in</p>
            <p id="pressure">Absolute Pressure: -- inHG</p>
            <p id="uv">UV Index: --</p>
            <p id="feellike">Feels Like: --</p>
        </div>
        </div>
        <p id="abspress" hidden></p>
        <div class="column">
        Today:
        <div id="icon1">
            <img src="icons/44.png" class="icon">
        </div>
        <p id="condition1">--</p>
        <p id="hi1" class="hi">High: --º</p>
        <p id="lo1" class="lo">Low: --º</p>
        </div>
        <div class="column">
            Tomorrow:
            <div id="icon2a">
                <img src="icons/44.png" class="icon">
            </div>
            <p id="condition2">--</p>
            <p id="hi2" class="hi">High: --º</p>
            <p id="lo2" class="lo">Low: --º</p>
        </div>
        <div class="column">
            2 Days Out:
            <div id="icon3">
                <img src="icons/44.png" class="icon">
            </div>
            <p id="condition3">--</p>
            <p id="hi3" class="hi">High: --º</p>
            <p id="lo3" class="lo">Low: --º</p>
        </div>
        <div class="column">
            3 Days Out:
            <div id="icon4">
                <img src="icons/44.png" class="icon">
            </div>
            <p id="condition4">--</p>
            <p id="hi4" class="hi">High: --º</p>
            <p id="lo4" class="lo">Low: --º</p>
        </div>
        <script>
            var abspressEl = document.getElementById("abspress");
            const inHGav = 29.97;
            const bendID = "KORBEND727";
            const apiKey = "be3a60645b954897ba60645b95f89776";
            var today = document.getElementById("condition");
            var future = document.getElementById("condition1");
            var tomorrow = document.getElementById("condition2");
            var iconEl = document.getElementById("icon");
            var icon1El =document.getElementById("icon1");
            var icon2El = document.getElementById("icon2a");
            var favEl = document.getElementById("favicon");
            var currentpressure;
            var hindex;
            var wchill;
            var temp1;
            var realFeel;
            var light;
            var rain;
            var time;
            var amtemp;
            var pressureRate;
            var billyJoel;
            var pressureRateOfChange= 0 ;
            var pressureRateOfChange1= 0;
            function drawPressureHistory (f){
                console.log("Historical Weather \n", f);
                for (var i = 0; i <= parseInt(f.observations.length); i++){
                    pressureRateOfChange = parseInt(pressureRateOfChange+ (f.observations[i].imperial.pressureTrend*100));
                    console.log("A", f.observations[i].imperial.pressureTrend);
                    console.log(pressureRateOfChange);
                    forecast(pressureRateOfChange);
                }
                    
                
            }
            function drawPressureHistory1 (e){
                for (var j = 0; j <= parseInt(e.observations.length); j++){
                    pressureRateOfChange1 = parseInt(pressureRateOfChange1+ (e.observations[j].imperial.pressureTrend*100));
                    forecast1(pressureRateOfChange1);
                }
            }
            function drawWeather (d){
                console.log("Weather data \n", d);
                hindex = d.observations[0].imperial.heatIndex;
                chill = d.observations[0].imperial.windChill; 
                temp1 = d.observations[0].imperial.temp;
                light = d.observations[0].solarRadiation;
                rain = d.observations[0].imperial.precipRate;
                time = d.observations[0].obsTimeLocal;
                amtemp = d.observations[0].imperial.temp;
                document.getElementById("condition").innerHTML = d.observations[0]
                document.getElementById("temp").innerHTML = "Temperature: "+ temp1+"ºF";
                document.getElementById("humidity").innerHTML = "Humidity: "+ d.observations[0].humidity +"%";
                document.getElementById("winddir").innerHTML = "Wind Direction: "+d.observations[0].winddir+"º";
                document.getElementById("windspeed").innerHTML = "Wind Speed: "+d.observations[0].imperial.windSpeed+" MPH";
                document.getElementById("windgusts").innerHTML = "Wind Gust: "+d.observations[0].imperial.windGust+" MPH";
                document.getElementById("precip").innerHTML = "Precipitation: "+d.observations[0].imperial.precipTotal+" in";
                document.getElementById("pressure").innerHTML = "Pressure: "+d.observations[0].imperial.pressure+"inHG";
                document.getElementById("uv").innerHTML = "UV Index: "+d.observations[0].uv;
                document.getElementById("feellike").innerHTML = "Feels Like: "+d.observations[0].imperial.heatIndex+"º";
                currentConditions(light, rain, time, amtemp);
                currentpressure = d.observations[0].imperial.pressure;
                abspressEl.innerHTML = currentpressure;
                //forecast(currentpressure);
                //feelslike(hindex, wchill);
            }
            function weatherBalloon(cityID){
                var key=apiKey;
                fetch('https://api.weather.com/v2/pws/observations/current?stationId='+cityID+'&format=json&units=e&apiKey='+key)
                .then(function(resp) {return resp.json() })
                .then(function(data) {
                    drawWeather(data);
                })
                .catch(function(){

                });  
                fetch('https://api.weather.com/v2/pws/observations/all/1day?stationId='+cityID+'&format=json&units=e&apiKey='+key)
                .then(function(resp) {return resp.json()})
                .then(function(data) {
                    drawPressureHistory(data);
                    drawPressureHistory1(data);
                })
                .catch(function(){

                });
                fetch('https://api.weather.com/v2/pws/observations/all/1day?stationId='+cityID+'&format=json&units=e&apiKey='+key)
                .then(function(resp) {return resp.json()})
                .then(function(data) {
                    drawPressureHistory1(data);
                })
                .catch(function(){

                }); 
                /*fetch('https://api.weather.com/v2/pws/observations/all/1day?stationId='+cityID+'&format=json&units=e&apiKey='+key)
                .then(function(resp) {return resp.json()})
                .then(function(data) {
                    drawPressureHistory1(data);
                })
                .catch(function(){

                });*/
            }
            var forecast= function( proc ){
                var proc1 = parseInt(proc);
                var av = parseInt(inHGav);
                if(proc1 < 5 && proc1 >= -5){
                    icon1El.innerHTML = "<img src='icons/28.png' class='icon'>";
                    future.innerHTML = "<p>Partly Cloudy</p>";
                } else if(proc1 >= 5){
                    icon1El.innerHTML = "<img src='icons/32.png' class='icon'>";
                    future.innerHTML = "<p>Sunny</p>";
                } else if(proc1 < -5 && proc1 >= -25){
                    icon1El.innerHTML = "<img src='icons/26.png' class='icon'>";
                    future.innerHTML = "<p>Cloudy</p>"
                } else if(proc1 < -25 && proc1 >= -50){
                    icon1El.innerHTML = "<img src='icons/12.png' class='icon'>";
                    future.innerHTML = "<p>Rainy</p>";
                } else if(proc1 < -50){
                    icon1El.innerHTML = "<img src='icons/4.png' class='icon'>";
                    future.innerHTML = "<p>Thundershowers</p>";
                }
            }
            var forecast1= function( proca ){
                console.log("1", parseInt(proca));
                var proc2 = parseInt(proca);
                console.log("1 \n", proc2);
                if(proc1 < 2.5 && proc1 >= -2.5){
                    icon2El.innerHTML = "<img src='icons/28.png' class='icon'>";
                    tomorrow.innerHTML = "<p>Partly Cloudy !</p>";
                } else if(proc1 >= 2.5){
                    icon2El.innerHTML = "<img src='icons/32.png' class='icon'>";
                    tomorrow.innerHTML = "<p>Sunny !</p>";
                } else if(proc1 < -2.5 && proc1 >= -12.5){
                    icon2El.innerHTML = "<img src='icons/26.png' class='icon'>";
                    tomorrow.innerHTML = "<p>Cloudy</p>"
                } else if(proc1 < -12.5 && proc1 >= -25){
                    icon2El.innerHTML = "<img src='icons/12.png' class='icon'>";
                    tomorrow.innerHTML = "<p>Rainy</p>";
                } else if(proc1 < -25){
                    icon2El.innerHTML = "<img src='icons/4.png' class='icon'>";
                    tomorrow.innerHTML = "<p>Thundershowers</p>";
                }
            }
            window.onload = function(){
                weatherBalloon(bendID);
                //forecast(currentpressure);
            }
            var currentConditions = function(l, r, t, a){
                var l1 = parseInt(l);
                var r1 = parseInt(r);
                var a1 = parseInt(a);
                var currentDate = new Date();
                var time = currentDate.getHours();
                console.log("Time: \n", time);
                if(l1 >= 0 && l1 <= 200 && r1 < 0.01){
                    if(time >= 7 && time < 19){
                        iconEl.innerHTML = "<img src='icons/26.png' class='icon'>";
                        today.innerHTML = "<p>Cloudy</p>";
                    } else if(time < 7 || time >= 19){
                        iconEl.innerHTML = "<img src='icons/27.png' class='icon'>";
                        today.innerHTML = "<p>Partly Cloudy</p>";
                    }
                }else if(l1 > 200 && l1<= 400 && r1 < 0.01){
                    if(time >= 7 && time < 19){
                        iconEl.innerHTML = "<img src='icons/28.png' class='icon'>";
                    } else if(time < 7 || time >= 19){
                        iconEl.innerHTML = "<img src='icons/27.png' class='icon'>";
                    }
                    today.innerHTML = "<p>Partly Cloudy</p>";
                }else if(l1 > 400){
                    if(time >= 7 && time < 19){
                        iconEl.innerHTML = "<img src='icons/32.png' class='icon'>";
                    } else if(time < 7 || time >= 19){
                        iconEl.innerHTML = "<img src='icons/31.png' class='icon'>";
                    }
                    today.innerHTML = "<p>Clear</p>";
                }else if(r1 === 0.01 && a1 > 32){
                    iconEl.innerHTML = "<img src='icons/9.png' class='icon'>";
                    today.innerHTML = "<p>Drizzle</p>";
                }else if(r1 > 0.01 && a1 > 32){
                    iconEl.innerHTML = "<img src='icons/12.png' class='icon'>";
                    today.innerHTML = "<p>Rain Showers</p>"
                }else if(r1 > 0 && a1 === 32){
                    iconEl.innerHTML = "<img src='icons/7.png' class='icon'>";
                    today.innerHTML = "<p>Wintery Mix</p>";
                }else if(r1 === 0.01 && a1 < 32){
                    iconEl.innerHTML = "<img src='icons/13.png' class='icon'>";
                    today.innerHTML = "<p>Flurries</p>";
                }else if(r1 > 0.01 && a1 < 32){
                    iconEl.innerHTML = "<img src='icons/14.png' class='icon'>";
                    today.innerHTML = "<p>Snow Showers</p>";
                }
            }
        </script>
    </body>
</html>
