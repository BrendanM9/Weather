<!DOCTYPE html>
<html>
    <head>
        <title>Central Oregon Forecast</title>
        <meta charset="UTF-8">
        <link rel="stylesheet" href="weatherstyle.css">
        <!--<div id="favicon"></div>-->
        <link rel="icon" type="image/x-icon" href="icons/12.png">
    </head>
    <body>
        <h1>Live local forecast:</h1>
        <div class="column">
            Current Conditions:
        <div id="currentc">
            <div id="icon">
                <img src="icons/44.png" class="icon">
            </div> 
            <p id="condition"></p>
            <p id="temp">Temperature: --ºF</p>
            <p id="humidity">Humidity: --%</p>
            <p id="winddir">Wind Direction: --º</p>
            <p id="windspeed">Wind Speed: -- MPH</p>
            <p id="windgusts">Wind Gust: -- MPH</p>
            <p id="precip">Precipitation: -- in</p>
            <p id="pressure">Absolute Pressure: -- inHG</p>
            <p id="uv">UV Index: --</p>
            <p id="feellike">Feels Like: --</p>
        </div>
        </div>
        <p id="abspress" hidden></p>
        <div class="column">
        Today:
        <div id="icon1">
            <img src="icons/44.png" class="icon">
        </div>
        <p id="condition1">--</p>
        <p id="hi1" class="hi">High: --º</p>
        <p id="lo1" class="lo">Low: --º</p>
        </div>
        <div class="column">
            Tomorrow:
            <div id="icon2a">
                <img src="icons/44.png" class="icon">
            </div>
            <p id="condition2">--</p>
            <p id="hi2" class="hi">High: --º</p>
            <p id="lo2" class="lo">Low: --º</p>
        </div>
        <div class="column">
            2 Days Out:
            <div id="icon3">
                <img src="icons/44.png" class="icon">
            </div>
            <p id="condition3">--</p>
            <p id="hi3" class="hi">High: --º</p>
            <p id="lo3" class="lo">Low: --º</p>
        </div>
        <div class="column">
            3 Days Out:
            <div id="icon4">
                <img src="icons/44.png" class="icon">
            </div>
            <p id="condition4">--</p>
            <p id="hi4" class="hi">High: --º</p>
            <p id="lo4" class="lo">Low: --º</p>
        </div>
        <script>
            var abspressEl = document.getElementById("abspress");
            const inHGav = 29.97;
            const bendID = "KORBEND727";
            const apiKey = "be3a60645b954897ba60645b95f89776";
            var today = document.getElementById("condition");
            var future = document.getElementById("condition1");
            var tomorrow = document.getElementById("condition2");
            var iconEl = document.getElementById("icon");
            var icon1El =document.getElementById("icon1");
            var icon2El = document.getElementById("icon2a");
            var favEl = document.getElementById("favicon");
            var currentpressure;
            var hindex;
            var wchill;
            var temp1;
            var realFeel;
            var light;
            var rain;
            var time;
            var amtemp;
            var pressureRate;
            var billyJoel;
            var pressureRateOfChange= 0 ;
            var pressureRateOfChange1;
            function drawPressureHistory (f){
                console.log("Historical Weather \n", f);
                for (var i = 0; i <= parseInt(f.observations.length); i++){
                    pressureRateOfChange = parseInt(pressureRateOfChange+ (f.observations[i].imperial.pressureTrend*100));
                    console.log("A", f.observations[i].imperial.pressureTrend);
                    console.log(pressureRateOfChange);
                }
                    /*pressureRateOfChange = parseInt((d.observations[1].imperial.pressureTrend+d.observations[2].imperial.pressureTrend+d.observations[3].imperial.pressureTrend+d.observations[4].imperial.pressureTrend+d.observations[5].imperial.pressureTrend+d.observations[6].imperial.pressureTrend+d.observations[7].imperial.pressureTrend+d.observations[8].imperial.pressureTrend+d.observations[9].imperial.pressureTrend+d.observations[10].imperial.pressureTrend+d.observations[11].imperial.pressureTrend+d.observations[12].imperial.pressureTrend+d.observations[13].imperial.pressureTrend+d.observations[14].imperial.pressureTrend+d.observations[15].imperial.pressureTrend+d.observations[16].imperial.pressureTrend+d.observations[17].imperial.pressureTrend+d.observations[18].imperial.pressureTrend+d.observations[19].imperial.pressureTrend+d.observations[20].imperial.pressureTrend+d.observations[21].imperial.pressureTrend+d.observations[22].imperial.pressureTrend+d.observations[23].imperial.pressureTrend+d.observations[24].imperial.pressureTrend+d.observations[25].imperial.pressureTrend+d.observations[26].imperial.pressureTrend+d.observations[27].imperial.pressureTrend+d.observations[28].imperial.pressureTrend+d.observations[29].imperial.pressureTrend+d.observations[30].imperial.pressureTrend+d.observations[31].imperial.pressureTrend+d.observations[32].imperial.pressureTrend+d.observations[33].imperial.pressureTrend+d.observations[34].imperial.pressureTrend+d.observations[35].imperial.pressureTrend+d.observations[36].imperial.pressureTrend+d.observations[37].imperial.pressureTrend+d.observations[38].imperial.pressureTrend+d.observations[39].imperial.pressureTrend+d.observations[40].imperial.pressureTrend+d.observations[41].imperial.pressureTrend+d.observations[42].imperial.pressureTrend+d.observations[43].imperial.pressureTrend+d.observations[44].imperial.pressureTrend+d.observations[45].imperial.pressureTrend+d.observations[46].imperial.pressureTrend+d.observations[47].imperial.pressureTrend+d.observations[48].imperial.pressureTrend+d.observations[49].imperial.pressureTrend+d.observations[50].imperial.pressureTrend+d.observations[51].imperial.pressureTrend+d.observations[52].imperial.pressureTrend+d.observations[53].imperial.pressureTrend+d.observations[54].imperial.pressureTrend+d.observations[55].imperial.pressureTrend+d.observations[56].imperial.pressureTrend+d.observations[57].imperial.pressureTrend+d.observations[58].imperial.pressureTrend+d.observations[59].imperial.pressureTrend+d.observations[60].imperial.pressureTrend+d.observations[61].imperial.pressureTrend+d.observations[62].imperial.pressureTrend+d.observations[63].imperial.pressureTrend+d.observations[64].imperial.pressureTrend+d.observations[65].imperial.pressureTrend+d.observations[66].imperial.pressureTrend+d.observations[67].imperial.pressureTrend+d.observations[68].imperial.pressureTrend+d.observations[69].imperial.pressureTrend+d.observations[70].imperial.pressureTrend+d.observations[71].imperial.pressureTrend+d.observations[72].imperial.pressureTrend+d.observations[73].imperial.pressureTrend+d.observations[74].imperial.pressureTrend+d.observations[75].imperial.pressureTrend+d.observations[76].imperial.pressureTrend+d.observations[77].imperial.pressureTrend+d.observations[78].imperial.pressureTrend+d.observations[79].imperial.pressureTrend+d.observations[80].imperial.pressureTrend+d.observations[81].imperial.pressureTrend+d.observations[82].imperial.pressureTrend+d.observations[83].imperial.pressureTrend+d.observations[84].imperial.pressureTrend+d.observations[85].imperial.pressureTrend+d.observations[86].imperial.pressureTrend+d.observations[87].imperial.pressureTrend+d.observations[88].imperial.pressureTrend+d.observations[89].imperial.pressureTrend+d.observations[90].imperial.pressureTrend+d.observations[91].imperial.pressureTrend+d.observations[92].imperial.pressureTrend+d.observations[93].imperial.pressureTrend+d.observations[94].imperial.pressureTrend+d.observations[95].imperial.pressureTrend+d.observations[96].imperial.pressureTrend+d.observations[97].imperial.pressureTrend+d.observations[98].imperial.pressureTrend+d.observations[99].imperial.pressureTrend+d.observations[100].imperial.pressureTrend+d.observations[101].imperial.pressureTrend+d.observations[102].imperial.pressureTrend+d.observations[103].imperial.pressureTrend+d.observations[104].imperial.pressureTrend+d.observations[105].imperial.pressureTrend+d.observations[106].imperial.pressureTrend+d.observations[107].imperial.pressureTrend+d.observations[108].imperial.pressureTrend+d.observations[109].imperial.pressureTrend+d.observations[110].imperial.pressureTrend+d.observations[111].imperial.pressureTrend+d.observations[112].imperial.pressureTrend+d.observations[113].imperial.pressureTrend+d.observations[114].imperial.pressureTrend+d.observations[115].imperial.pressureTrend+d.observations[116].imperial.pressureTrend+d.observations[117].imperial.pressureTrend+d.observations[118].imperial.pressureTrend+d.observations[119].imperial.pressureTrend+d.observations[120].imperial.pressureTrend+d.observations[121].imperial.pressureTrend+d.observations[122].imperial.pressureTrend+d.observations[123].imperial.pressureTrend+d.observations[124].imperial.pressureTrend+d.observations[125].imperial.pressureTrend+d.observations[126].imperial.pressureTrend+d.observations[127].imperial.pressureTrend+d.observations[128].imperial.pressureTrend+d.observations[129].imperial.pressureTrend+d.observations[130].imperial.pressureTrend+d.observations[131].imperial.pressureTrend+d.observations[132].imperial.pressureTrend+d.observations[133].imperial.pressureTrend+d.observations[134].imperial.pressureTrend+d.observations[135].imperial.pressureTrend+d.observations[136].imperial.pressureTrend+d.observations[137].imperial.pressureTrend+d.observations[138].imperial.pressureTrend+d.observations[139].imperial.pressureTrend+d.observations[140].imperial.pressureTrend+d.observations[141].imperial.pressureTrend+d.observations[142].imperial.pressureTrend+d.observations[143].imperial.pressureTrend+d.observations[144].imperial.pressureTrend+d.observations[145].imperial.pressureTrend+d.observations[146].imperial.pressureTrend+d.observations[147].imperial.pressureTrend+d.observations[148].imperial.pressureTrend+d.observations[149].imperial.pressureTrend+d.observations[150].imperial.pressureTrend+d.observations[151].imperial.pressureTrend+d.observations[152].imperial.pressureTrend+d.observations[153].imperial.pressureTrend+d.observations[154].imperial.pressureTrend+d.observations[155].imperial.pressureTrend+d.observations[156].imperial.pressureTrend+d.observations[157].imperial.pressureTrend+d.observations[158].imperial.pressureTrend+d.observations[159].imperial.pressureTrend+d.observations[160].imperial.pressureTrend+d.observations[161].imperial.pressureTrend+d.observations[162].imperial.pressureTrend+d.observations[163].imperial.pressureTrend+d.observations[164].imperial.pressureTrend+d.observations[165].imperial.pressureTrend+d.observations[166].imperial.pressureTrend+d.observations[167].imperial.pressureTrend+d.observations[168].imperial.pressureTrend+d.observations[169].imperial.pressureTrend+d.observations[170].imperial.pressureTrend+d.observations[171].imperial.pressureTrend+d.observations[172].imperial.pressureTrend+d.observations[173].imperial.pressureTrend+d.observations[174].imperial.pressureTrend+d.observations[175].imperial.pressureTrend+d.observations[176].imperial.pressureTrend+d.observations[177].imperial.pressureTrend+d.observations[178].imperial.pressureTrend+d.observations[179].imperial.pressureTrend+d.observations[180].imperial.pressureTrend+d.observations[181].imperial.pressureTrend+d.observations[182].imperial.pressureTrend+d.observations[183].imperial.pressureTrend+d.observations[184].imperial.pressureTrend+d.observations[185].imperial.pressureTrend+d.observations[186].imperial.pressureTrend+d.observations[187].imperial.pressureTrend+d.observations[188].imperial.pressureTrend+d.observations[189].imperial.pressureTrend+d.observations[190].imperial.pressureTrend+d.observations[191].imperial.pressureTrend+d.observations[192].imperial.pressureTrend+d.observations[193].imperial.pressureTrend+d.observations[194].imperial.pressureTrend+d.observations[195].imperial.pressureTrend+d.observations[196].imperial.pressureTrend+d.observations[197].imperial.pressureTrend+d.observations[198].imperial.pressureTrend+d.observations[199].imperial.pressureTrend+d.observations[200].imperial.pressureTrend+d.observations[201].imperial.pressureTrend+d.observations[202].imperial.pressureTrend+d.observations[203].imperial.pressureTrend+d.observations[204].imperial.pressureTrend+d.observations[205].imperial.pressureTrend+d.observations[206].imperial.pressureTrend+d.observations[207].imperial.pressureTrend+d.observations[208].imperial.pressureTrend+d.observations[209].imperial.pressureTrend+d.observations[210].imperial.pressureTrend+d.observations[211].imperial.pressureTrend+d.observations[212].imperial.pressureTrend+d.observations[213].imperial.pressureTrend+d.observations[214].imperial.pressureTrend+d.observations[215].imperial.pressureTrend+d.observations[216].imperial.pressureTrend+d.observations[217].imperial.pressureTrend+d.observations[218].imperial.pressureTrend+d.observations[219].imperial.pressureTrend+d.observations[220].imperial.pressureTrend+d.observations[221].imperial.pressureTrend+d.observations[222].imperial.pressureTrend+d.observations[223].imperial.pressureTrend+d.observations[224].imperial.pressureTrend+d.observations[225].imperial.pressureTrend+d.observations[226].imperial.pressureTrend+d.observations[227].imperial.pressureTrend+d.observations[228].imperial.pressureTrend+d.observations[229].imperial.pressureTrend+d.observations[230].imperial.pressureTrend+d.observations[231].imperial.pressureTrend+d.observations[232].imperial.pressureTrend+d.observations[233].imperial.pressureTrend+d.observations[234].imperial.pressureTrend+d.observations[235].imperial.pressureTrend+d.observations[236].imperial.pressureTrend+d.observations[237].imperial.pressureTrend+d.observations[238].imperial.pressureTrend+d.observations[239].imperial.pressureTrend+d.observations[240].imperial.pressureTrend+d.observations[241].imperial.pressureTrend+d.observations[242].imperial.pressureTrend+d.observations[243].imperial.pressureTrend+d.observations[244].imperial.pressureTrend+d.observations[245].imperial.pressureTrend+d.observations[246].imperial.pressureTrend+d.observations[247].imperial.pressureTrend+d.observations[248].imperial.pressureTrend+d.observations[249].imperial.pressureTrend+d.observations[250].imperial.pressureTrend+d.observations[251].imperial.pressureTrend+d.observations[252].imperial.pressureTrend+d.observations[253].imperial.pressureTrend+d.observations[254].imperial.pressureTrend+d.observations[255].imperial.pressureTrend+d.observations[256].imperial.pressureTrend)*100);*/
                    //console.log(pressureRateOfChange);
                    forecast(pressureRateOfChange);
                
            }
            /*function drawPressureHistory1 (d){
                for (j = 0; j <= 400; j+=2){
                    pressureRateOfChange1 = (d.observations[j].imperial.pressureTrend + d.observations[j+1].imperial.pressureTrend) * 100;
                    console.log("a", pressureRateOfChange1);
                    console.log("a", parseInt(pressureRateOfChange1));
                    forecast1(pressureRateOfChange1);
                };
            }*/
            function drawWeather (d){
                console.log("Weather data \n", d);
                hindex = d.observations[0].imperial.heatIndex;
                chill = d.observations[0].imperial.windChill; 
                temp1 = d.observations[0].imperial.temp;
                light = d.observations[0].solarRadiation;
                rain = d.observations[0].imperial.precipRate;
                time = d.observations[0].obsTimeLocal;
                amtemp = d.observations[0].imperial.temp;
                document.getElementById("condition").innerHTML = d.observations[0]
                document.getElementById("temp").innerHTML = "Temperature: "+ temp1+"ºF";
                document.getElementById("humidity").innerHTML = "Humidity: "+ d.observations[0].humidity +"%";
                document.getElementById("winddir").innerHTML = "Wind Direction: "+d.observations[0].winddir+"º";
                document.getElementById("windspeed").innerHTML = "Wind Speed: "+d.observations[0].imperial.windSpeed+" MPH";
                document.getElementById("windgusts").innerHTML = "Wind Gust: "+d.observations[0].imperial.windGust+" MPH";
                document.getElementById("precip").innerHTML = "Precipitation: "+d.observations[0].imperial.precipTotal+" in";
                document.getElementById("pressure").innerHTML = "Pressure: "+d.observations[0].imperial.pressure+"inHG";
                document.getElementById("uv").innerHTML = "UV Index: "+d.observations[0].uv;
                document.getElementById("feellike").innerHTML = "Feels Like: "+d.observations[0].imperial.heatIndex+"º";
                currentConditions(light, rain, time, amtemp);
                currentpressure = d.observations[0].imperial.pressure;
                abspressEl.innerHTML = currentpressure;
                //forecast(currentpressure);
                //feelslike(hindex, wchill);
            }
            function weatherBalloon(cityID){
                var key=apiKey;
                fetch('https://api.weather.com/v2/pws/observations/current?stationId='+cityID+'&format=json&units=e&apiKey='+key)
                .then(function(resp) {return resp.json() })
                .then(function(data) {
                    drawWeather(data);
                })
                .catch(function(){

                });  
                fetch('https://api.weather.com/v2/pws/observations/all/1day?stationId='+cityID+'&format=json&units=e&apiKey='+key)
                .then(function(resp) {return resp.json()})
                .then(function(data) {
                    drawPressureHistory(data);
                    //drawPressureHistory1(data);
                })
                .catch(function(){

                });
                /*fetch('https://api.weather.com/v2/pws/observations/all/1day?stationId='+cityID+'&format=json&units=e&apiKey='+key)
                .then(function(resp) {return resp.json()})
                .then(function(data) {
                    drawPressureHistory1(data);
                })
                .catch(function(){

                });*/
            }
            var forecast= function( proc ){
                var proc1 = parseInt(proc);
                var av = parseInt(inHGav);
                if(proc1 < 5 && proc1 >= -5){
                    icon1El.innerHTML = "<img src='icons/28.png' class='icon'>";
                    future.innerHTML = "<p>Partly Cloudy</p>";
                } else if(proc1 >= 5){
                    icon1El.innerHTML = "<img src='icons/32.png' class='icon'>";
                    future.innerHTML = "<p>Sunny</p>";
                } else if(proc1 < -5 && proc1 >= -25){
                    icon1El.innerHTML = "<img src='icons/26.png' class='icon'>";
                    future.innerHTML = "<p>Cloudy</p>"
                } else if(proc1 < -25 && proc1 >= -50){
                    icon1El.innerHTML = "<img src='icons/12.png' class='icon'>";
                    future.innerHTML = "<p>Rainy</p>";
                } else if(proc1 < -50){
                    icon1El.innerHTML = "<img src='icons/4.png' class='icon'>";
                    future.innerHTML = "<p>Thundershowers</p>";
                }
            }
            /*var forecast1= function( proca ){
                console.log("1", parseInt(proca));
                var proc2 = parseInt(proca);
                console.log("1 \n", proc2);
                if(proc1 < 2.5 && proc1 >= -2.5){
                    icon2El.innerHTML = "<img src='icons/28.png' class='icon'>";
                    tomorrow.innerHTML = "<p>Partly Cloudy !</p>";
                } else if(proc1 >= 2.5){
                    icon2El.innerHTML = "<img src='icons/32.png' class='icon'>";
                    tomorrow.innerHTML = "<p>Sunny !</p>";
                } else if(proc1 < -2.5 && proc1 >= -12.5){
                    icon2El.innerHTML = "<img src='icons/26.png' class='icon'>";
                    tomorrow.innerHTML = "<p>Cloudy</p>"
                } else if(proc1 < -12.5 && proc1 >= -25){
                    icon2El.innerHTML = "<img src='icons/12.png' class='icon'>";
                    tomorrow.innerHTML = "<p>Rainy</p>";
                } else if(proc1 < -25){
                    icon2El.innerHTML = "<img src='icons/4.png' class='icon'>";
                    tomorrow.innerHTML = "<p>Thundershowers</p>";
                }
            }*/
            window.onload = function(){
                weatherBalloon(bendID);
                //forecast(currentpressure);
            }
            var currentConditions = function(l, r, t, a){
                var l1 = parseInt(l);
                var r1 = parseInt(r);
                var a1 = parseInt(a);
                var currentDate = new Date();
                var time = currentDate.getHours();
                console.log("Time: \n", time);
                if(l1 >= 0 && l1 <= 200 && r1 < 0.01){
                    if(time >= 7 && time < 19){
                        iconEl.innerHTML = "<img src='icons/26.png' class='icon'>";
                        today.innerHTML = "<p>Cloudy</p>";
                    } else if(time < 7 || time >= 19){
                        iconEl.innerHTML = "<img src='icons/27.png' class='icon'>";
                        today.innerHTML = "<p>Partly Cloudy</p>";
                    }
                }else if(l1 > 200 && l1<= 400 && r1 < 0.01){
                    if(time >= 7 && time < 19){
                        iconEl.innerHTML = "<img src='icons/28.png' class='icon'>";
                    } else if(time < 7 || time >= 19){
                        iconEl.innerHTML = "<img src='icons/27.png' class='icon'>";
                    }
                    today.innerHTML = "<p>Partly Cloudy</p>";
                }else if(l1 > 400){
                    if(time >= 7 && time < 19){
                        iconEl.innerHTML = "<img src='icons/32.png' class='icon'>";
                    } else if(time < 7 || time >= 19){
                        iconEl.innerHTML = "<img src='icons/31.png' class='icon'>";
                    }
                    today.innerHTML = "<p>Clear</p>";
                }else if(r1 === 0.01 && a1 > 32){
                    iconEl.innerHTML = "<img src='icons/9.png' class='icon'>";
                    today.innerHTML = "<p>Drizzle</p>";
                }else if(r1 > 0.01 && a1 > 32){
                    iconEl.innerHTML = "<img src='icons/12.png' class='icon'>";
                    today.innerHTML = "<p>Rain Showers</p>"
                }else if(r1 > 0 && a1 === 32){
                    iconEl.innerHTML = "<img src='icons/7.png' class='icon'>";
                    today.innerHTML = "<p>Wintery Mix</p>";
                }else if(r1 === 0.01 && a1 < 32){
                    iconEl.innerHTML = "<img src='icons/13.png' class='icon'>";
                    today.innerHTML = "<p>Flurries</p>";
                }else if(r1 > 0.01 && a1 < 32){
                    iconEl.innerHTML = "<img src='icons/14.png' class='icon'>";
                    today.innerHTML = "<p>Snow Showers</p>";
                }
            }
        </script>
    </body>
</html>
